## Приложение для Благотворительного фонда поддержки котиков QRKot

### О проекте

Фонд собирает пожертвования на различные целевые проекты: на медицинское обслуживание нуждающихся хвостатых, на обустройство кошачьей колонии в подвале, на корм оставшимся без попечения кошкам — на любые цели, связанные с поддержкой кошачьей популяции.

### Проекты
В Фонде QRKot может быть открыто несколько целевых проектов. У каждого проекта есть название, описание и сумма, которую планируется собрать. После того, как нужная сумма собрана — проект закрывается.
Пожертвования в проекты поступают по принципу First In, First Out: все пожертвования идут в проект, открытый раньше других; когда этот проект набирает необходимую сумму и закрывается — пожертвования начинают поступать в следующий проект.

### Пожертвования
Каждый пользователь может сделать пожертвование и сопроводить его комментарием. Пожертвования не целевые: они вносятся в фонд, а не в конкретный проект. Каждое полученное пожертвование автоматически добавляется в первый открытый проект, который ещё не набрал нужную сумму. Если пожертвование больше нужной суммы или же в Фонде нет открытых проектов — оставшиеся деньги ждут открытия следующего проекта. При создании нового проекта все неинвестированные пожертвования автоматически вкладываются в новый проект.

### Пользователи
Целевые проекты создаются администраторами сайта. 
Любой пользователь может видеть список всех проектов, включая требуемые и уже внесенные суммы. Это касается всех проектов — и открытых, и закрытых.
Зарегистрированные пользователи могут отправлять пожертвования и просматривать список своих пожертвований.

### Используемые технологии
- Python 3.9.10
- Alembic 1.7.7
- SQLalchemy 1.4.49
- SQLlite
- FastAPI 0.78.0
- FastAPI Users 10.0.6
- Uvicorn

### Установка и запуск

**Клонируйте репозиторий:**

```
git clone git@github.com:Rederickmind/cat_charity_fund.git
```

```
cd cat_charity_fund
```

**Установите и активируйте виртуальное окружение:**

```
python -m venv venv
```

* Если у вас Linux/macOS

    ```
    source venv/bin/activate
    ```

* Если у вас windows

    ```
    source venv/scripts/activate
    ```

**Обновите менеджер pip и установите зависимости**

```
python -m pip install --upgrade pip
```

```
pip install -r requirements.txt
```

### Необходимо заполнить env-файл для запуска
```
touch .env
```
```
# .env
APP_TITLE = Кошачий благотворительный фонд (QR Kot)
DESCRIPTION = Сервис для поддержки котов
DATABASE_URL = sqlite+aiosqlite:///./fastapi.db
SECRET = Секретное слово
FIRST_SUPERUSER_EMAIL = Е-мэил суперпользователя, который создастся при запуске приложения
FIRST_SUPERUSER_PASSWORD = Пароль суперпользователя, который создастся при запуске приложениял
```


### Необходимо инициализировать Alembic в проекте, создать и выполнить миграции:
- следует указать, что Alembic должен использовать асинхронный шаблон --template async (или короткая форма -t async)
```
alembic init --template async alembic
```
- Генерация миграций
```
alembic revision --autogenerate -m "First migration"
```
- Применение миграций
```
alembic upgrade head
```
Если что-то пошло не так — можно отменить миграции: одну, несколько или вообще все.
Чтобы отменить все миграции, которые были в проекте, используется команда:
```
alembic downgrade base 
```

### Запуск проекта:
```
uvicorn app.main:app --reload
```

- После запуска проект будет доступен по адресу: http://127.0.0.1:8000
- http://127.0.0.1:8000/docs - автоматически сгенерированная документация Swagger
- http://127.0.0.1:8000/redoc - автоматически сгенерированная документация ReDoc

### После запуска доступны следующие эндпоинты:
- Регистрация и аутентификация:
    - **/auth/register** - регистрация пользователя
    - **/auth/jwt/login** - аутентификация пользователя (получение jwt-токена)
    - **/auth/jwt/logout** - выход (сброс jwt-токена)
- Пользователи:
    - **/users/me** - получение и изменение данных аутентифицированного пользователя
    - **/users/{id}** - получение и изменение данных пользователя по id (для суперпользователя)
- Благотворительные проекты:
    - **/charity_project/** - получение списка проектов и создание нового
    - **/charity_project/{project_id}** - изменение и удаление существующего проекта (для суперпользователя)
- Пожертвования:
    - **/donation/** - получение списка всех пожертвований и создание пожертвования
    - **/donation/my** - получение списка всех пожертвований аутентифицированного пользователя

### Автор проекта:
Никита Лёвушкин, когорта ЯП 19+